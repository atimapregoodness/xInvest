<!-- ===================== NAVBAR ===================== -->
<nav class="navbar navbar-expand-lg fixed-top glass-nav py-2" id="mainNavbar">
  <div class="container d-flex align-items-center justify-content-between">
    <!-- Brand -->
    <a class="navbar-brand d-flex align-items-center" href="/">
      <i class="fas fa-chart-line text-accent me-2"></i>
      <span class="fw-bold text-white fs-5">xInvest</span>
    </a>

    <!-- Toggle (mobile only) -->
    <button
      class="navbar-toggler border-0 shadow-none"
      type="button"
      id="mobileToggler"
      aria-label="Toggle navigation"
      aria-expanded="false"
      aria-controls="navbarNav"
    >
      <i class="fas fa-bars text-white fs-4"></i>
    </button>

    <!-- Nav Links (desktop) -->
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-lg-center gap-lg-2 text-center">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>

        <!-- Company -->
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            href="#"
            id="companyDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Company
          </a>
          <ul class="dropdown-menu" aria-labelledby="companyDropdown">
            <li><a class="dropdown-item" href="/about">About Us</a></li>
            <li><a class="dropdown-item" href="/contact">Contact Us</a></li>
            <li><a class="dropdown-item" href="/careers">Careers</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/bots">Auto Invest</a>
        </li>
        <li class="nav-item"><a class="nav-link" href="/faqs">FAQs</a></li>

        <!-- Account -->
        <li class="nav-item dropdown mt-2 mt-lg-0" id="dropdown">
          <a
            class="btn dropdown-toggle px-3 py-1 d-flex align-items-center"
            href="#"
            id="accountDropdown"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="fas fa-user-circle me-2"></i>
            Account
          </a>

          <ul
            class="dropdown-menu"
            aria-labelledby="accountDropdown"
            id="acctContents"
          >
            <% if (user) { %>
            <li class="nav-item">
              <a class="nav-link" href="/bots">Auto Invest</a>
            </li>
            <li class="px-3 py-2 text-center">
              <img
                src="<%= user.profileImage || '/images/default-avatar.png' %>"
                alt="Profile Image"
                class="rounded-circle mb-2"
                width="60"
                height="60"
              />
              <h6 class="mb-0"><%= user.fullName || 'John Doe' %></h6>
              <small class="text-muted"
                ><%= user.country || 'Unknown Country' %></small
              >
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a class="dropdown-item" href="/dashboard"
                ><i class="fas fa-user me-2 text-accent"></i>Dashboard</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="/auth/logout"
                ><i class="fas fa-sign-out-alt me-2 text-accent"></i>Logout</a
              >
            </li>

            <% } else { %>
            <li>
              <a class="dropdown-item" href="/auth/login"
                ><i class="fas fa-sign-in-alt me-2 text-accent"></i>Login</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="/auth/register"
                ><i class="fas fa-user-plus me-2 text-accent"></i>Register</a
              >
            </li>
            <% } %>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Mobile slide menu (duplicate of links but styled for slide) -->
<nav id="mobileSlide" class="mobile-slide" aria-hidden="true">
  <div class="mobile-slide-inner">
    <div
      class="mobile-header d-flex align-items-center justify-content-between mb-3"
    >
      <a class="navbar-brand d-flex align-items-center" href="/">
        <i class="fas fa-chart-line text-accent me-2"></i>
        <span class="fw-bold text-white fs-5">xInvest</span>
      </a>
      <button
        class="btn btn-close btn-close-white"
        id="mobileClose"
        aria-label="Close"
      ></button>
    </div>

    <ul class="mobile-nav list-unstyled mb-3">
      <li><a class="mobile-link" href="/">Home</a></li>
      <li><a class="mobile-link" href="/about">About Us</a></li>
      <li><a class="mobile-link" href="/contact">Contact Us</a></li>
      <li><a class="mobile-link" href="/careers">Careers</a></li>
      <li><a class="mobile-link" href="/bots">Auto Invest</a></li>
      <li><a class="mobile-link" href="/faqs">FAQs</a></li>
    </ul>

    <div class="mobile-account mt-auto">
      <% if (user) { %>

      <a class="mobile-link d-block" href="/dashboard">Dashboard</a>
      <a class="mobile-link d-block" href="/auth/logout">Logout</a>
      <% } else { %>
      <a class="mobile-link d-block" href="/auth/login">Login</a>
      <a class="mobile-link d-block" href="/auth/register">Register</a>
      <% } %>
    </div>
  </div>
</nav>

<!-- Overlay -->
<div id="mobileOverlay" class="mobile-overlay" aria-hidden="true"></div>

<!-- ===================== SCRIPTS ===================== -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggler = document.getElementById("mobileToggler");
    const mobile = document.getElementById("mobileSlide");
    const overlay = document.getElementById("mobileOverlay");
    const mobileClose = document.getElementById("mobileClose");
    const navbarNav = document.getElementById("navbarNav");

    const isMobile = () => window.matchMedia("(max-width: 991px)").matches;

    function openMobile() {
      mobile.classList.add("open");
      overlay.classList.add("show");
      mobile.setAttribute("aria-hidden", "false");
      toggler.setAttribute("aria-expanded", "true");
    }

    function closeMobile() {
      mobile.classList.remove("open");
      overlay.classList.remove("show");
      mobile.setAttribute("aria-hidden", "true");
      toggler.setAttribute("aria-expanded", "false");
    }

    // Toggler click: only on small screens
    toggler.addEventListener("click", (e) => {
      if (!isMobile()) return;
      if (mobile.classList.contains("open")) closeMobile();
      else openMobile();
    });

    // Close buttons
    mobileClose.addEventListener("click", closeMobile);
    overlay.addEventListener("click", closeMobile);

    // Close when a mobile link is clicked
    document.querySelectorAll(".mobile-link").forEach((el) => {
      el.addEventListener("click", () => {
        if (isMobile()) closeMobile();
      });
    });

    // ensure when resizing to desktop the mobile panel is hidden
    window.addEventListener("resize", () => {
      if (!isMobile()) {
        mobile.classList.remove("open");
        overlay.classList.remove("show");
        mobile.setAttribute("aria-hidden", "true");
        toggler.setAttribute("aria-expanded", "false");
      }
    });
  });
</script>
