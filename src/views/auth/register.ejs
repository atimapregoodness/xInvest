<%- layout('layout/boilerplate', { title: 'meziumFx - Create Account' }) %>

<div
  class="container d-flex justify-content-center align-items-center min-vh-100 register"
  id="auth"
>
  <div class="glass-card login-card text-center" data-aos="fade-up">
    <div class="mb-4">
      <h2 class="text-white fw-bold mb-2">Create Account</h2>
      <p class="text-muted small">Join meziumFx and start trading securely</p>
    </div>

    <form
      action="/auth/register"
      method="POST"
      class="login-form mt-3"
      id="signupForm"
      novalidate
    >
      <input type="hidden" name="fullPhone" id="fullPhoneInput" />

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-user"></i
        ></span>
        <input
          type="text"
          name="fullName"
          class="form-control glass-input"
          placeholder="Full Name"
          required
          minlength="2"
          value="<%= formData?.fullName || '' %>"
        />
        <div class="invalid-feedback">Please enter your full name.</div>
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-envelope"></i
        ></span>
        <input
          type="email"
          name="email"
          class="form-control glass-input"
          placeholder="Email Address"
          required
          value="<%= formData?.email || '' %>"
        />
        <div class="invalid-feedback">Please enter a valid email.</div>
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-globe"></i
        ></span>
        <select
          name="country"
          class="form-select glass-input"
          id="countryInput"
          required
        >
          <%- include('../partials/countrySelect', { selectedCountry:
          formData?.country }) %>
        </select>
        <div class="invalid-feedback">Select your country.</div>
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-phone"></i
        ></span>
        <input
          type="text"
          name="phone"
          class="form-control glass-input"
          placeholder="Phone Number"
          id="phoneNumberInput"
          required
          pattern="^[0-9]{7,15}$"
          value="<%= formData?.phone || '' %>"
        />
        <div class="invalid-feedback">Enter a valid phone number.</div>
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-lock"></i
        ></span>
        <input
          type="password"
          name="password"
          class="form-control glass-input"
          placeholder="Password"
          required
          minlength="8"
          id="passwordInput"
        />
        <div class="invalid-feedback">
          Password must be 8+ characters with letters and numbers.
        </div>
      </div>

      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-lock"></i
        ></span>
        <input
          type="password"
          name="confirmPassword"
          class="form-control glass-input"
          placeholder="Confirm Password"
          required
          id="confirmPasswordInput"
        />
        <div class="invalid-feedback">Passwords do not match.</div>
      </div>

      <div class="form-check mb-3 text-start">
        <input
          class="form-check-input"
          type="checkbox"
          id="termsCheck"
          required
        />
        <label class="form-check-label small text-muted" for="termsCheck">
          I accept the
          <a href="/terms" target="_blank" class="text-accent"
            >Terms & Conditions</a
          >
        </label>
        <div class="invalid-feedback">You must accept the terms.</div>
      </div>

      <button type="submit" class="btn btn-accent holographic w-100 mb-3">
        <i class="fas fa-user-plus me-2"></i>Create Account
      </button>

      <div class="divider my-4"><span>OR</span></div>

      <p class="text-muted small">
        Already have an account?
        <a href="/auth/login" class="text-accent fw-semibold">Login</a>
      </p>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    AOS.init({ duration: 600, easing: "ease-out-cubic", once: true });

    const form = document.getElementById("signupForm");
    const countrySelect = document.getElementById("countryInput");
    const phoneNumberInput = document.getElementById("phoneNumberInput");
    const fullPhoneInput = document.getElementById("fullPhoneInput");
    const passwordInput = document.getElementById("passwordInput");
    const confirmPasswordInput = document.getElementById(
      "confirmPasswordInput"
    );

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      countrySelect.classList.remove("is-invalid");
      confirmPasswordInput.classList.remove("is-invalid");

      if (!form.checkValidity()) {
        form.classList.add("was-validated");
        return;
      }

      const countryCode =
        countrySelect.options[countrySelect.selectedIndex]?.dataset.code;
      if (!countryCode) {
        countrySelect.classList.add("is-invalid");
        return;
      }

      fullPhoneInput.value = `${countryCode}${phoneNumberInput.value}`;

      if (passwordInput.value !== confirmPasswordInput.value) {
        confirmPasswordInput.classList.add("is-invalid");
        return;
      }

      form.submit();
    });

    confirmPasswordInput.addEventListener("input", () => {
      if (confirmPasswordInput.value !== passwordInput.value) {
        confirmPasswordInput.classList.add("is-invalid");
      } else {
        confirmPasswordInput.classList.remove("is-invalid");
      }
    });
  });
</script>
