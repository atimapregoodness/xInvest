<%- layout('layout/boilerplate', { title: 'xInvest - Create Account' }) %>

<div
  class="container d-flex justify-content-center align-items-center min-vh-100 register"
  id="auth"
>
  <div class="glass-card login-card text-center" data-aos="fade-up">
    <!-- Header -->
    <div class="mb-4">
      <h2 class="text-white fw-bold mb-2">Create Account</h2>
      <p class="text-muted small">Join xInvest and start trading securely</p>
    </div>

    <!-- Signup Form -->
    <form
      action="/auth/register"
      method="POST"
      class="login-form mt-3"
      id="signupForm"
      novalidate
    >
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="fullPhone" id="fullPhoneInput" />

      <!-- Full Name -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-user"></i
        ></span>
        <input
          type="text"
          name="fullName"
          class="form-control glass-input"
          placeholder="Full Name"
          required
          minlength="2"
        />
        <div class="invalid-feedback">Please enter your full name.</div>
      </div>

      <!-- Email -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-envelope"></i
        ></span>
        <input
          type="email"
          name="email"
          class="form-control glass-input"
          placeholder="Email Address"
          required
        />
        <div class="invalid-feedback">Please enter a valid email.</div>
      </div>

      <!-- Country -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-globe"></i
        ></span>
        <select
          name="country"
          class="form-select glass-input"
          id="countryInput"
          required
        >
          <option value="" disabled selected>Select Country</option>
          <% const countries = [ { name: "Nigeria", code: "+234" }, { name:
          "United States", code: "+1" }, { name: "United Kingdom", code: "+44"
          }, { name: "India", code: "+91" }, { name: "Canada", code: "+1" }, {
          name: "South Africa", code: "+27" }, { name: "Ghana", code: "+233" },
          { name: "Kenya", code: "+254" }, { name: "UAE", code: "+971" }, {
          name: "Germany", code: "+49" }, { name: "France", code: "+33" }, {
          name: "Brazil", code: "+55" }, { name: "Australia", code: "+61" } ];
          %> <% countries.forEach(c => { %>
          <option value="<%= c.name %>" data-code="<%= c.code %>">
            <%= c.name %> (<%= c.code %>)
          </option>
          <% }) %>
        </select>
        <div class="invalid-feedback">Select your country.</div>
      </div>

      <!-- Phone Number -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-phone"></i
        ></span>
        <input
          type="text"
          name="phone"
          class="form-control glass-input"
          placeholder="Phone Number"
          id="phoneNumberInput"
          required
          pattern="^[0-9]{7,15}$"
        />
        <div class="invalid-feedback">Enter a valid phone number.</div>
      </div>

      <!-- Password -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-lock"></i
        ></span>
        <input
          type="password"
          name="password"
          class="form-control glass-input"
          placeholder="Password"
          required
          minlength="8"
          id="passwordInput"
          pattern="^(?=.*[A-Za-z])(?=.*\\d).{8,}$"
        />
        <div class="invalid-feedback">
          Password must be 8+ characters with letters and numbers.
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="input-group mb-3">
        <span class="input-group-text glass-input-icon"
          ><i class="fas fa-lock"></i
        ></span>
        <input
          type="password"
          name="confirmPassword"
          class="form-control glass-input"
          placeholder="Confirm Password"
          required
          id="confirmPasswordInput"
        />
        <div class="invalid-feedback">Passwords do not match.</div>
      </div>

      <!-- Terms -->
      <div class="form-check mb-3 text-start">
        <input
          class="form-check-input"
          type="checkbox"
          id="termsCheck"
          required
        />
        <label class="form-check-label small text-muted" for="termsCheck">
          I accept the
          <a href="/terms" target="_blank" class="text-accent"
            >Terms & Conditions</a
          >
        </label>
        <div class="invalid-feedback">You must accept the terms.</div>
      </div>

      <!-- Button -->
      <button type="submit" class="btn btn-accent holographic w-100 mb-3">
        <i class="fas fa-user-plus me-2"></i>Create Account
      </button>

      <!-- Divider -->
      <div class="divider my-4"><span>OR</span></div>

      <!-- Login Link -->
      <p class="text-muted small">
        Already have an account?
        <a href="/auth/login" class="text-accent fw-semibold">Login</a>
      </p>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    AOS.init({ duration: 600, easing: "ease-out-cubic", once: true });

    const form = document.getElementById("signupForm");
    const countrySelect = document.getElementById("countryInput");
    const phoneNumberInput = document.getElementById("phoneNumberInput");
    const fullPhoneInput = document.getElementById("fullPhoneInput");
    const passwordInput = document.getElementById("passwordInput");
    const confirmPasswordInput = document.getElementById(
      "confirmPasswordInput"
    );

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        form.classList.add("was-validated");
        return;
      }

      const countryCode =
        countrySelect.options[countrySelect.selectedIndex]?.dataset.code || "";
      if (!countryCode) {
        countrySelect.classList.add("is-invalid");
        return;
      }

      fullPhoneInput.value = `${countryCode}${phoneNumberInput.value}`;

      if (passwordInput.value !== confirmPasswordInput.value) {
        confirmPasswordInput.classList.add("is-invalid");
        return;
      }

      form.submit();
    });

    confirmPasswordInput.addEventListener("input", () => {
      if (confirmPasswordInput.value !== passwordInput.value) {
        confirmPasswordInput.classList.add("is-invalid");
      } else {
        confirmPasswordInput.classList.remove("is-invalid");
      }
    });
  });
</script>
