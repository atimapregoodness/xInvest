<%- layout('layout/adminBoilerplate', { title: 'Manage Users' }) %>

<div class="container-fluid py-4">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="text-white mb-0">
      <i class="fa-solid fa-users me-2 text-accent"></i> Manage Users
    </h2>
  </div>

  <div class="accordion" id="usersAccordion">
    <% users.forEach((user, index) => { %>
    <div class="accordion-item glass mb-3 border-0 rounded shadow-sm">
      <!-- Accordion Header -->
      <h2 class="accordion-header" id="heading-<%= index %>">
        <button
          class="accordion-button collapsed bg-transparent text-white fw-semibold"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapse-<%= index %>"
          aria-expanded="false"
          aria-controls="collapse-<%= index %>"
        >
          <i class="fa-solid fa-user me-2 text-accent"></i>
          <%= user.fullName %> â€”
          <small class="ms-2 text-muted"><%= user.email %></small>
        </button>
      </h2>

      <!-- Accordion Body -->
      <div
        id="collapse-<%= index %>"
        class="accordion-collapse collapse"
        aria-labelledby="heading-<%= index %>"
        data-bs-parent="#usersAccordion"
      >
        <div class="accordion-body bg-dark text-white rounded-bottom">
          <div class="row g-3 align-items-center">
            <div class="col-md-3">
              <p class="mb-1"><strong>Status:</strong></p>
              <span
                class="badge <%= user.isRestricted ? 'bg-danger' : 'bg-success' %>"
              >
                <%= user.isRestricted ? 'Restricted' : 'Active' %>
              </span>
            </div>
            <div class="col-md-5">
              <p class="mb-1"><strong>Wallet:</strong></p>
              <% if (user.wallet) { %>
              <small class="text-muted">
                BTC: <%= user.wallet.BTC || 0 %> | ETH: <%= user.wallet.ETH || 0
                %> | USDT: <%= user.wallet.USDT || 0 %>
              </small>
              <% } else { %>
              <small class="text-muted">No wallet data</small>
              <% } %>
            </div>
          </div>

          <hr class="my-3 border-secondary" />

          <!-- Update Balance Form -->
          <form
            action="/admin/user/update-balance/<%= user._id %>"
            method="POST"
            class="d-flex flex-wrap align-items-center gap-2 mb-3"
          >
            <select name="currency" class="form-select form-select-sm w-auto">
              <option value="BTC">BTC</option>
              <option value="ETH">ETH</option>
              <option value="USDT">USDT</option>
            </select>
            <input
              type="number"
              name="amount"
              placeholder="Amount"
              class="form-control form-control-sm w-auto"
              required
            />
            <button class="btn btn-sm btn-primary">
              <i class="fa-solid fa-coins me-1"></i> Update Balance
            </button>
          </form>

          <!-- Restrict / Unrestrict -->
          <div class="d-flex flex-wrap align-items-center gap-2">
            <% if (!user.isRestricted) { %>
            <form
              action="/admin/user/restrict/<%= user._id %>"
              method="POST"
              class="d-inline"
            >
              <button class="btn btn-sm btn-warning">
                <i class="fa-solid fa-ban me-1"></i> Restrict
              </button>
            </form>
            <% } else { %>
            <form
              action="/admin/user/unrestrict/<%= user._id %>"
              method="POST"
              class="d-inline"
            >
              <button class="btn btn-sm btn-success">
                <i class="fa-solid fa-unlock me-1"></i> Unrestrict
              </button>
            </form>
            <% } %>

            <!-- Delete User -->
            <form
              action="/admin/user/delete/<%= user._id %>"
              method="POST"
              class="d-inline"
              onsubmit="return confirm('Are you sure you want to delete this user?')"
            >
              <button class="btn btn-sm btn-danger">
                <i class="fa-solid fa-trash me-1"></i> Delete
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <% }) %>
  </div>
</div>
