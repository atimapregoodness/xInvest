<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %> - Finovex</title>

    <!-- ====== SEO META TAGS ====== -->
    <meta
      name="description"
      content="Advanced crypto investment platform with secure trading, investment plans, and professional tools."
    />
    <meta
      name="keywords"
      content="crypto, bitcoin, ethereum, usdt, investment, trading, blockchain, forex, analysis"
    />
    <meta name="author" content="Finovex" />

    <!-- ====== OPEN GRAPH ====== -->
    <meta property="og:title" content="<%= title %> - Finovex" />
    <meta
      property="og:description"
      content="Advanced crypto investment platform and forex analytics."
    />
    <meta property="og:type" content="website" />

    <!-- ====== FAVICON ====== -->
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    <!-- ====== GOOGLE FONTS ====== -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- ====== BOOTSTRAP 5 ====== -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />

    <!-- ====== FONT AWESOME (Kit + Fallback) ====== -->
    <!-- Fallback CSS (in case kit fails to load) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-KNu9XW3xRcpD5q1EZXFxR4XxZzKDaKfFJ3btEXKkR5QfRQOqku1msSRSS1vYH8xNCHz4ljnhnlvDfR7fIKhp9w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Your Kit (loads brands + pro icons if enabled) -->
    <script
      src="https://kit.fontawesome.com/cd82447c08.js"
      crossorigin="anonymous"
    ></script>

    <!-- ====== CHART.JS ====== -->
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"
      integrity="sha384-CwbXk2BTUQbRVHiZ0H9aB7iK7tAEfHduQKLF8a9iX+kqyzEwV4QXkl8GiUGzEhrP"
      crossorigin="anonymous"
    ></script>
    <!-- ===================== HEAD DEPENDENCIES ===================== -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>
    <!-- ====== TRADINGVIEW (for Advanced Market Analysis) ====== -->
    <script src="https://s3.tradingview.com/tv.js"></script>

    <!-- ====== CUSTOM CSS ====== -->
    <link rel="stylesheet" href="/css/main.css" />

    <!-- ====== CSRF TOKEN ====== -->
    <meta name="csrf-token" content="<%= csrfToken %>" />
  </head>

  <body>
    <!-- ====== NAVBAR ====== -->
    <%- partial('partials/navbar') %> <%- partial('partials/loader') %> <%-
    partial('partials/alerts') %>

    <!-- ====== MAIN CONTENT ====== -->
    <main class="min-vh-100" id="main"><%- body %></main>

    <!-- ====== BOOTSTRAP JS ====== -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gH6tQ9w+0qAbUXMQeIQ5hzvDUIhQe0cC+f7G4O/yi7Er9LZ6k7BDJ9jGxZ1M+0nM"
      crossorigin="anonymous"
    ></script>
    <!-- i18next (translation library) -->
    <script src="https://unpkg.com/i18next@21.6.10/dist/umd/i18next.min.js"></script>

    <script>
      // =================== DIAGNOSTIC TEST ===================
      async function diagnosticTest() {
        console.log("ðŸš€ Starting diagnostic test...");

        try {
          // Test 1: Check if endpoint exists
          console.log("1. Testing endpoint existence...");
          const testResponse = await fetch("/dashboard/bots/purchase", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              planId: "welbuilder",
              paymentMethod: "usdt",
            }),
          });

          console.log("Endpoint status:", testResponse.status);
          console.log("Endpoint headers:", {
            "content-type": testResponse.headers.get("content-type"),
            "content-length": testResponse.headers.get("content-length"),
          });

          const responseText = await testResponse.text();
          console.log("Response preview:", responseText.substring(0, 200));

          // Test 2: Check if it's a routing issue
          console.log("2. Testing alternative endpoints...");
          const endpoints = [
            "/api/bots/purchase",
            "/api/purchase",
            "/purchase",
            "/bots/purchase",
          ];

          for (const endpoint of endpoints) {
            try {
              const test = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ test: true }),
              });
              console.log(`Endpoint ${endpoint}: ${test.status}`);
            } catch (e) {
              console.log(`Endpoint ${endpoint}: Failed - ${e.message}`);
            }
          }

          return true;
        } catch (error) {
          console.error("Diagnostic test failed:", error);
          return false;
        }
      }

      // Run diagnostic
      // await diagnosticTest();
    </script>

    <!-- ====== SOCKET.IO & APP JS ====== -->
    <script src="/js/script.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/plans.js"></script>
    <script src="/js/animations.js"></script>
    <script src="/js/charts.js"></script>
    <script src="/js/dashboard.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- ====== CSRF GLOBAL VARIABLE ====== -->
    <script>
      const CSRF_TOKEN = "<%= csrfToken %>";
    </script>
  </body>
</html>
